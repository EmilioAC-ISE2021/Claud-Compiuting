# HITO 3
En este hito se implementa una API RESTFUL para poder usar la aplicación sin el frontend. Como no me quedó claro que la práctica iba a ir de esto, implementé un front-end completo para la práctica 2...
La API sirve la misma funcionalidad que el front-end. La aplicación está completa.
Para no complicarme la vida, la api no usa de autenticación. Llevaría demasiado tiempo implementarlo. La aplicación se basa en un [sistema de honor](/hitos/recursos/3/VIRUS.jpg). Por fans y para fans. Honor entre piratas.
Estos son los endpoints de la API. GET obtiene el objeto, POST crea uno nuevo, PUT lo actualiza, DELETE, adivina.

## Usuarios

- `GET /api/usuarios`
- `GET /api/usuarios/{username}`
- `POST /api/usuarios`
- `PUT /api/usuarios/{username}`
- `DELETE /api/usuarios/{username}`

## Grupos

- `GET /api/grupos`
- `GET /api/grupos/{nombre}`
- `POST /api/grupos`
- `DELETE /api/grupos/{nombre}`

## Series

- `GET /api/grupos/{nombreGrupo}/series`
- `GET /api/grupos/{nombreGrupo}/series/{nombreSerie}`
- `POST /api/grupos/{nombreGrupo}/series`
- `PUT /api/grupos/{nombreGrupo}/series/{nombreSerie}`
- `DELETE /api/grupos/{nombreGrupo}/series/{nombreSerie}`

## Capítulos

- `GET /api/grupos/{nombreGrupo}/series/{nombreSerie}/capitulos`
- `GET /api/grupos/{nombreGrupo}/series/{nombreSerie}/capitulos/{nombreCapitulo}`
- `POST /api/grupos/{nombreGrupo}/series/{nombreSerie}/capitulos`
- `POST /api/grupos/{nombreGrupo}/series/{nombreSerie}/capitulos/bulk`
- `DELETE /api/grupos/{nombreGrupo}/series/{nombreSerie}/capitulos/{nombreCapitulo}`

## Tareas

- `GET /api/grupos/{nombreGrupo}/series/{nombreSerie}/capitulos/{nombreCapitulo}/tareas`
- `GET /api/grupos/{nombreGrupo}/series/{nombreSerie}/capitulos/{nombreCapitulo}/tareas/{nombreTarea}`
- `POST /api/grupos/{nombreGrupo}/series/{nombreSerie}/capitulos/{nombreCapitulo}/tareas`
- `PUT /api/grupos/{nombreGrupo}/series/{nombreSerie}/capitulos/{nombreCapitulo}/tareas/{nombreTarea}`
- `DELETE /api/grupos/{nombreGrupo}/series/{nombreSerie}/capitulos/{nombreCapitulo}/tareas/{nombreTarea}`

## Usuarios de un grupo

- `POST /api/usuarios/{username}/grupos/{nombreGrupo}`
- `DELETE /api/usuarios/{username}/grupos/{nombreGrupo}`
- `PUT /api/usuarios/{username}/grupos/{nombreGrupo}/rol`

## Tecnologías empleadas

Como framework para desarrollo del microservicio se ha usado Spring Boot. La justificación está en la [memoria del hito 2](/hitos/2.md).

Como framework de logging, se ha usado SLF4J con Logback. Juntos, forman el estándar de logs de Spring Boot. 

SLF4J es una fachada de logging. Es una capa de abstracción que permite modificar el sistema de logging sin tener que modificar el código.
Logback es el estándar de login para aplicaciones Sprin Boot. Las alternativas consideradas han sido el sistema nativo de java, java.util.logging, y Log4j. No he usado el de java por ser demasiado básico. Aunque serviría en esta versión de la aplicación, no quería usarla por si en el futuro se necesita un logging más avanzado. Log4j sufre de lo contrario, es más potente, pero como no voy a usar su funcionalidad avanzada (v.gr. logs asíncronos) he elegido logback, que es más simple y robusto.

Aquí un ejemplo de los logs (son los generados al ejecutar los tests)
![logs](/hitos/recursos/3/logs.png)

## Separación en capas

Se ha implementado la aplicación siguiendo un sistema de capas. Hay una capa, model, de modelo, para modelar las entidades. Una capa, repository, para operaciones de base de datos. Una capa de servicio llamada service, que implementa la lógica de negocio. Y hay dos capas de vista. Controller implementa la vista para el navegador web, y controller.api implementa la API RESTFUL.

## Tests

Se han implementado tests exhaustivos de los endpoints de la API. Se han probado tanto llamadas que debían tener éxito, como llamadas que debían fallar. Son llamados por el sistema de integración continua en cada push al repositorio.

- **Grupos**: Se comprueba el ciclo de vida completo: listar todos los grupos, obtener uno por nombre, crearlo (manejando conflictos si ya existe), y eliminarlo.
- **Series**: Se asegura que se puedan listar, obtener, crear, actualizar y eliminar series dentro del contexto de un grupo.
- **Capítulos**: Se valida el listado, obtención, creación (individual y en masa), y eliminación de capítulos para una serie.
- **Tareas**: Se verifica el listado, obtención, creación, actualización (de estado y asignación) y eliminación de tareas para un capítulo.
- **Usuarios**: Se comprueba la gestión de usuarios, incluyendo listado, obtención por nombre, creación, actualización y eliminación.
- **Asociación Usuario-Grupo**: Se prueba que se pueda añadir y eliminar un usuario de un grupo, y cambiar su rol dentro de ese grupo.

Aquí se puede ver el resultado de la ejecución exitosa de los tests.
![tests ok](/hitos/recursos/3/tests.png)

Por último, añadiré que para ejecutar la aplicación, navegamos a sars y ejecutamos ./mvnw clean install spring-boot:run

