<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org"
      th:replace="~{layout :: layout(content=~{::content}, titulo='Dashboard')}">

<th:block th:fragment="content">
    <style type="text/css">* {cursor: url(https://cur.cursors-4u.net/toons/too-4/too372.cur), auto !important;}</style>
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2 class="mb-0">
            Grupo: <span class="fw-bold" th:text="${grupo.nombre}">Nombre del Grupo</span>
        </h2>
        
        <a th:if="${rolEnGrupoActual.name() == 'ROLE_LIDER'}" 
           th:href="@{/grupo/{nombreGrupo}/gestionar(nombreGrupo=${grupo.nombre})}" 
           class="btn btn-outline-secondary">
            Gestionar Usuarios del Grupo
        </a>
    </div>

    <hr>

    <div th:if="${rolEnGrupoActual.name() == 'ROLE_LIDER'}">
        <div class="row">
            <div class="col-md-8 offset-md-2">
                <h4 class="mb-3">Crear Nueva Serie</h4>
                <form th:action="@{/serie/crear}" method="post" class="card p-3">
                    <div class="mb-3">
                        <label for="nombre" class="form-label">Nombre de la Serie</label>
                        <input type="text" class="form-control" id="nombre" name="nombre" required>
                    </div>
                    <div class="mb-3">
                        <label for="descripcion" class="form-label">Descripción</label>
                        <input type="text" class="form-control" id="descripcion" name="descripcion">
                    </div>
                    <button type="submit" class="btn btn-primary">Crear Serie</button>
                </form>
            </div>
        </div>
    </div>

    <hr class="my-5">

    <div class="row">
        <div class="col-md-10 offset-md-1">
            <h4 class="mb-3">Series del Grupo</h4>
            
            <div th:if="${series.isEmpty() and rolEnGrupoActual.name() == 'ROLE_LIDER'}" class="alert alert-info">
                Este grupo aún no tiene series. ¡Crea una!
            </div>
            <div th:if="${series.isEmpty() and rolEnGrupoActual.name() != 'ROLE_LIDER'}" class="alert alert-info">
                Este grupo aún no tiene series.
            </div>

            <table class="table table-hover" th:if="${!series.isEmpty()}">
                <thead>
                    <tr>
                        <th>Nombre de la Serie</th>
                    </tr>
                </thead>
                <tbody>
                    <tr th:each="serie : ${series}">
                        <td>
                            <div class="d-flex justify-content-between align-items-center">
                                <a th:href="@{/serie/{nombreSerie}(nombreSerie=${serie.nombre})}" th:text="${serie.nombre}">Nombre de Serie</a>
                                <form th:action="@{/serie/{nombreSerie}/eliminar(nombreSerie=${serie.nombre})}" method="post" onsubmit="return confirm('¿Estás seguro de que quieres eliminar esta serie?');" th:if="${rolEnGrupoActual.name() == 'ROLE_LIDER'}">
                                    <button type="submit" class="btn btn-danger btn-sm">
                                        <i class="bi bi-trash"></i>
                                    </button>
                                </form>
                            </div>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <div class="row mt-5" th:if="${rolEnGrupoActual.name() == 'ROLE_LIDER'}">
        <div class="col-md-10 offset-md-1">
            <div class="card border-danger">
                <div class="card-header bg-danger text-white">
                    Zona de Peligro
                </div>
                <div class="card-body">
                    <h5 class="card-title">Eliminar Grupo</h5>
                    <p class="card-text">Esta acción es irreversible. Se eliminarán todas las series y capítulos asociados al grupo, y todos los usuarios serán desvinculados.</p>
                    <button type="button" class="btn btn-danger" onclick="confirmarEliminacionGrupo()">Eliminar este grupo</button>
                    <form th:action="@{/grupo/eliminar}" method="post" id="deleteGroupForm" style="display: none;">
                        <input type="hidden" name="nombreGrupo" th:value="${grupo.nombre}" />
                    </form>
                </div>
            </div>
        </div>
    </div>

    <script th:inline="javascript">
    /*<![CDATA[*/
    function confirmarEliminacionGrupo() {
        const nombreGrupo = /*[[${grupo.nombre}]]*/ 'nombreDelGrupo';
        const confirm1 = prompt("Estás a punto de eliminar el grupo '" + nombreGrupo + "'. Esta acción no se puede deshacer. Escribe 'ELIMINAR' para continuar.");
        if (confirm1 === 'ELIMINAR') {
            const confirm2 = prompt("Todos los datos asociados al grupo, incluyendo series y tareas, se perderán permanentemente. Escribe 'ELIMINAR' de nuevo para confirmar.");
            if (confirm2 === 'ELIMINAR') {
                const confirm3 = prompt("Esta es tu última oportunidad. ¿Estás absolutamente seguro? Escribe 'ELIMINAR' por última vez.");
                if (confirm3 === 'ELIMINAR') {
                    document.getElementById('deleteGroupForm').submit();
                } else {
                    alert('La eliminación del grupo ha sido cancelada.');
                }
            } else {
                alert('La eliminación del grupo ha sido cancelada.');
            }
        } else {
            alert('La eliminación del grupo ha sido cancelada.');
        }
    }
    /*]]>*/
    </script>

</th:block>
</html>
