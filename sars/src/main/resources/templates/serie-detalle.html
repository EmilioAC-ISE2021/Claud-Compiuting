<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Detalle de la Serie</title>
    <style>
        body { font-family: sans-serif; margin: 2em; background: #f4f4f4; }
        .container { max-width: 1200px; margin: auto; background: #fff; padding: 2em; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        h1, h2, h3 { color: #333; }
        a { color: #007bff; }
        form { display: inline-block; }
        button { background: #007bff; color: white; padding: 8px 12px; border: none; border-radius: 4px; cursor: pointer; }
        button:hover { background: #0056b3; }
        input[type="text"] { padding: 8px; border: 1px solid #ccc; border-radius: 4px; }
        
        .form-add-capitulo { margin-bottom: 2em; border: 1px solid #ddd; padding: 1em; border-radius: 5px; }
        
        .capitulo { border: 1px solid #e0e0e0; border-radius: 5px; margin-bottom: 1.5em; }
        .capitulo-titulo { background: #f9f9f9; padding: 10px 15px; border-bottom: 1px solid #e0e0e0; }
        
        .tareas-container { display: flex; flex-wrap: wrap; align-items: flex-start; padding: 15px; }
        
        .tarea-card {
            min-width: 200px; border: 1px solid #ccc; border-radius: 4px;
            padding: 10px; margin-right: 10px; margin-bottom: 10px;
            background: #fafafa;
        }
        .tarea-card strong { display: block; margin-bottom: 5px; color: #0056b3; }
        .tarea-card p { font-size: 0.9em; margin: 5px 0; }
        .tarea-card select { width: 100%; padding: 5px; margin-top: 5px; }

        .form-add-tarea {
            min-width: 200px; border: 2px dashed #ccc; border-radius: 4px;
            padding: 10px; margin-right: 10px; margin-bottom: 10px;
            background: #fdfdfd;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 th:text="${serie.nombre}">Nombre de la Serie</h1>
        <p th:text="${serie.descripcion}">Descripción de la serie</p>
        <a href="/">&larr; Volver a todas las series</a>

        <hr style="margin: 2em 0;">

        <div class="form-add-capitulo">
            <h2>Añadir Capítulo</h2>
            <form method="post" th:action="@{/serie/{nombre}/crear-capitulo(nombre=${serie.nombre})}">
                <input type="text" name="nombreCapitulo" placeholder="Nombre del nuevo capítulo" required>
                <button type="submit">Añadir Capítulo</button>
            </form>
        </div>

        <h2>Capítulos</h2>
        <div class="capitulo" th:each="capitulo : ${serie.capitulos}">
            
            <div class="capitulo-titulo">
                <h3 th:text="${capitulo.nombre}">Nombre del Capítulo</h3>
            </div>
            
            <div class="tareas-container">
                
                <div class="tarea-card" th:each="tarea : ${capitulo.tareas}">
                    <strong th:text="${tarea.nombre}">Nombre de Tarea</strong>
                    <p th:text="'Usuario: ' + ${tarea.usuarioAsignado}">Usuario: Nadie</p>
                    
                    <form method="post" th:action="@{/serie/{serie}/capitulo/{cap}/tarea/{tarea}/actualizar-estado(serie=${serie.nombre}, cap=${capitulo.nombre}, tarea=${tarea.nombre})}">
                        <select name="estado" onchange="this.form.submit()">
                            <option th:each="e : ${todosLosEstados}"
                                    th:value="${e}"
                                    th:text="${e}"
                                    th:selected="${e == tarea.estadoTarea}">
                                Estado
                            </option>
                        </select>
                        <noscript><button type="submit">Actualizar</button></noscript>
                    </form>
                </div>

                <div class="form-add-tarea">
                    <form method="post" th:action="@{/serie/{serie}/capitulo/{cap}/crear-tarea(serie=${serie.nombre}, cap=${capitulo.nombre})}">
                        <input type="text" name="nombreTarea" placeholder="Nueva Tarea" required style="width: 100%; box-sizing: border-box;">
                        <button type="submit" style="margin-top: 5px;">Añadir Tarea</button>
                    </form>
                </div>

            </div>
        </div>

    </div>
</body>
</html>